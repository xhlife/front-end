const str = "å•Šæ˜¯ğŸ”å¨ƒå¨ƒï¼Œğ ®·æ˜¯çœŸçš„å•Š";

console.log(str.length); // 13
console.log(str.slice(2, 3)); // å¾—åˆ°ä¹±ç 

/*
 * ä¸ºä»€ä¹ˆé•¿åº¦æ˜¯13ï¼Ÿ
 * è§£æï¼š å¸¸è§„å­—ç¬¦å ç”¨ä¸€ä¸ªç å…ƒï¼Œ è€Œç‰¹æ®Šå­—ç¬¦å ä¸¤ä¸ªç å…ƒï¼Œ jsä¸­å­—ç¬¦ä¸²çš„lengthè¯»å–çš„æ˜¯ç å…ƒçš„é•¿åº¦
 *        åœ¨utf-16ç¼–ç ä¸­ï¼Œä¸€ä¸ªç ç‚¹å¯èƒ½å 16ä½ï¼Œä¹Ÿå¯èƒ½å 32ä½
 *       strä¸­ï¼Œ ğŸ”å’Œğ ®· ç‰¹æ®Šå­—ç¬¦ï¼Œå æ®äº†ä¸¤ä¸ªå­—ç¬¦ï¼Œå› æ­¤lengthæ¯”å¸¸è§„çš„å¤šå‡ºäº†2ï¼Œ å› æ­¤æˆªå–çš„æ—¶å€™ä¼šå¾—åˆ°ä¹±ç 
 *
 * è§£å†³åŠæ³•ï¼š é‡‡ç”¨ç ç‚¹æ–¹å¼è¿›è¡Œæˆªå–, ç ç‚¹ï¼š ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªç ç‚¹
 */

String.prototype.sliceByPoint = function (pStart, pEnd) {
  let result = "";
  let pIndex = 0; // ç ç‚¹æŒ‡é’ˆ
  let cIndex = 0; // ç å…ƒæŒ‡é’ˆ

  while (1) {
    if (pIndex >= pEnd || cIndex >= this.length) {
      break;
    }
    const point = this.codePointAt(cIndex); // æ‹¿åˆ°ç ç‚¹çš„å€¼ï¼Œ æœ‰å¯èƒ½æ˜¯16ä½ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯32ä½
    if (pIndex >= pStart) {
      result += String.fromCodePoint(point); // é€šè¿‡ç ç‚¹æ¢å¤å­—ç¬¦ï¼Œ ä¸èƒ½é‡‡ç”¨ä¸‹æ ‡çš„æ–¹å¼è·å–
    }
    cIndex += point > 0xffff ? 2 : 1; // å¦‚æœç ç‚¹çš„å€¼æ¯”16ä½æœ€å¤§å€¼è¿˜å¤§ï¼Œè¯´æ˜è¯¥å­—ç¬¦å ä¸¤ä¸ªç å…ƒ
    pIndex++;
  }
  return result;
};

console.log(str.sliceByPoint(2, 3)); // ğŸ”
